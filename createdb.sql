BEGIN TRANSACTION;
CREATE TABLE 'announcements' ('id' INTEGER PRIMARY KEY NOT NULL, 'text' TEXT NOT NULL, 'by' INTEGER NOT NULL DEFAULT 0 ,'date' INTEGER NOT NULL);
CREATE TABLE 'collections' ('id' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 'type' INTEGER NOT NULL, 'by' INTEGER NOT NULL, 'created_at' INTEGER NOT NULL, 'last_updated' INTEGER DEFAULT NULL, 'data' TEXT NOT NULL , 'is_pfp' BOOLEAN NOT NULL DEFAULT 0, 'name'  TEXT NOT NULL  , 'mode' INTEGER NOT NULL DEFAULT 0);
CREATE TABLE 'collection_ratings' ('rater' INTEGER NOT NULL, 'collection' INTEGER NOT NULL, 'is_positive' BOOLEAN NOT NULL DEFAULT 1 );
CREATE TABLE "user_blocks" ('blocker' INTEGER NOT NULL, 'blocked' INTEGER NOT NULL);
CREATE TABLE 'messages' ('sender' INTEGER NOT NULL,'recipient' INTEGER NOT NULL, 'message' TEXT NOT NULL, 'date' INTEGER NOT NULL DEFAULT ((strftime('%s','now'))), 'id'  INTEGER PRIMARY KEY NOT NULL  , 'type' INTEGER NOT NULL DEFAULT 0);
CREATE TABLE 'marketplace_listings' ('id' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 'user' INTEGER NOT NULL, 'gem' INTEGER NOT NULL, 'amount' INTEGER NOT NULL, 'price' INTEGER NOT NULL,'type' INTEGER NOT NULL,'created' INTEGER NOT NULL DEFAULT (strftime('%s','now')));
CREATE TABLE 'users' ('id' INTEGER PRIMARY KEY NOT NULL, 'name' TEXT NOT NULL, 'identificator_id' TEXT NOT NULL , 'is_admin' BOOLEAN NOT NULL DEFAULT 0, 'is_premium' BOOLEAN NOT NULL DEFAULT 0, 'money' INTEGER NOT NULL DEFAULT 0, 'date_signed_up' INTEGER NOT NULL DEFAULT (strftime('%s','now')), 'last_login' INTEGER NOT NULL DEFAULT (strftime('%s','now')), 'shifts_completed' INTEGER NOT NULL DEFAULT 0, 'energy' INTEGER NOT NULL DEFAULT 250,'read_notifications' BOOLEAN NOT NULL DEFAULT 1, 'date_became_premium' INTEGER DEFAULT NULL, 'location' INTEGER NOT NULL DEFAULT 0, '0' INTEGER NOT NULL DEFAULT 0, '1' INTEGER NOT NULL DEFAULT 0, '2' INTEGER NOT NULL DEFAULT 0, '3' INTEGER NOT NULL DEFAULT 0, '4' INTEGER NOT NULL DEFAULT 0, '5' INTEGER NOT NULL DEFAULT 0, '6' INTEGER NOT NULL DEFAULT 0, '7' INTEGER NOT NULL DEFAULT 0, '8' INTEGER NOT NULL DEFAULT 0, '9' INTEGER NOT NULL DEFAULT 0, '10' INTEGER NOT NULL DEFAULT 0, '11' INTEGER NOT NULL DEFAULT 0, '12' INTEGER NOT NULL DEFAULT 0, `13` INTEGER DEFAULT 0 NOT NULL, `14` INTEGER DEFAULT 0 NOT NULL, `15` INTEGER DEFAULT 0 NOT NULL, `16` INTEGER DEFAULT 0 NOT NULL, `17` INTEGER DEFAULT 0 NOT NULL, `18` INTEGER DEFAULT 0 NOT NULL, `19` INTEGER DEFAULT 0 NOT NULL, `20` INTEGER DEFAULT 0 NOT NULL, `21` INTEGER DEFAULT 0 NOT NULL, `22` INTEGER DEFAULT 0 NOT NULL, `23` INTEGER DEFAULT 0 NOT NULL, `24` INTEGER DEFAULT 0 NOT NULL, `25` INTEGER DEFAULT 0 NOT NULL, `26` INTEGER DEFAULT 0 NOT NULL, `27` INTEGER DEFAULT 0 NOT NULL, `28` INTEGER DEFAULT 0 NOT NULL, `29` INTEGER DEFAULT 0 NOT NULL, `30` INTEGER DEFAULT 0 NOT NULL, `31` INTEGER DEFAULT 0 NOT NULL, `32` INTEGER DEFAULT 0 NOT NULL, `33` INTEGER DEFAULT 0 NOT NULL, `34` INTEGER DEFAULT 0 NOT NULL, `35` INTEGER DEFAULT 0 NOT NULL, `36` INTEGER DEFAULT 0 NOT NULL, `37` INTEGER DEFAULT 0 NOT NULL, `38` INTEGER DEFAULT 0 NOT NULL, `39` INTEGER DEFAULT 0 NOT NULL, `40` INTEGER DEFAULT 0 NOT NULL, `41` INTEGER DEFAULT 0 NOT NULL, `42` INTEGER DEFAULT 0 NOT NULL, `43` INTEGER DEFAULT 0 NOT NULL, `44` INTEGER DEFAULT 0 NOT NULL, `45` INTEGER DEFAULT 0 NOT NULL, `46` INTEGER DEFAULT 0 NOT NULL, `47` INTEGER DEFAULT 0 NOT NULL, `48` INTEGER DEFAULT 0 NOT NULL, `49` INTEGER DEFAULT 0 NOT NULL, `50` INTEGER DEFAULT 0 NOT NULL, `51` INTEGER DEFAULT 0 NOT NULL, `52` INTEGER DEFAULT 0 NOT NULL, `53` INTEGER DEFAULT 0 NOT NULL, `54` INTEGER DEFAULT 0 NOT NULL, `55` INTEGER DEFAULT 0 NOT NULL, `56` INTEGER DEFAULT 0 NOT NULL, `57` INTEGER DEFAULT 0 NOT NULL, `58` INTEGER DEFAULT 0 NOT NULL, `59` INTEGER DEFAULT 0 NOT NULL, `60` INTEGER DEFAULT 0 NOT NULL, `61` INTEGER DEFAULT 0 NOT NULL, `62` INTEGER DEFAULT 0 NOT NULL, `63` INTEGER DEFAULT 0 NOT NULL, `64` INTEGER DEFAULT 0 NOT NULL, `65` INTEGER DEFAULT 0 NOT NULL, `66` INTEGER DEFAULT 0 NOT NULL, `67` INTEGER DEFAULT 0 NOT NULL, `68` INTEGER DEFAULT 0 NOT NULL, `69` INTEGER DEFAULT 0 NOT NULL, `70` INTEGER DEFAULT 0 NOT NULL, `71` INTEGER DEFAULT 0 NOT NULL, `72` INTEGER DEFAULT 0 NOT NULL, `73` INTEGER DEFAULT 0 NOT NULL, `74` INTEGER DEFAULT 0 NOT NULL, `75` INTEGER DEFAULT 0 NOT NULL, `76` INTEGER DEFAULT 0 NOT NULL, `77` INTEGER DEFAULT 0 NOT NULL, `78` INTEGER DEFAULT 0 NOT NULL, `79` INTEGER DEFAULT 0 NOT NULL, `80` INTEGER DEFAULT 0 NOT NULL, `81` INTEGER DEFAULT 0 NOT NULL, `82` INTEGER DEFAULT 0 NOT NULL, `83` INTEGER DEFAULT 0 NOT NULL, `84` INTEGER DEFAULT 0 NOT NULL, `85` INTEGER DEFAULT 0 NOT NULL, `86` INTEGER DEFAULT 0 NOT NULL, `87` INTEGER DEFAULT 0 NOT NULL, `88` INTEGER DEFAULT 0 NOT NULL, `89` INTEGER DEFAULT 0 NOT NULL, `90` INTEGER DEFAULT 0 NOT NULL, `91` INTEGER DEFAULT 0 NOT NULL, `92` INTEGER DEFAULT 0 NOT NULL, `93` INTEGER DEFAULT 0 NOT NULL, `94` INTEGER DEFAULT 0 NOT NULL, `95` INTEGER DEFAULT 0 NOT NULL, `96` INTEGER DEFAULT 0 NOT NULL, `97` INTEGER DEFAULT 0 NOT NULL, `98` INTEGER DEFAULT 0 NOT NULL, `99` INTEGER DEFAULT 0 NOT NULL, 'tag_style' INTEGER NOT NULL DEFAULT 0, 'profile_background' INTEGER NOT NULL DEFAULT 0, 'tag_font' INTEGER NOT NULL DEFAULT 0, 'read_announcements' BOOLEAN NOT NULL DEFAULT 0, 'birthstone' INTEGER NOT NULL DEFAULT 0, 'navbar_backgrounds' TEXT NOT NULL DEFAULT '[0]', '100' INTEGER NOT NULL DEFAULT 0, `102` INTEGER NOT NULL DEFAULT 0, `103` INTEGER NOT NULL DEFAULT 0, `104` INTEGER NOT NULL DEFAULT 0, `105` INTEGER NOT NULL DEFAULT 0, `106` INTEGER NOT NULL DEFAULT 0, `107` INTEGER NOT NULL DEFAULT 0, `108` INTEGER NOT NULL DEFAULT 0, `109` INTEGER NOT NULL DEFAULT 0, `110` INTEGER NOT NULL DEFAULT 0, `111` INTEGER NOT NULL DEFAULT 0, `112` INTEGER NOT NULL DEFAULT 0, `113` INTEGER NOT NULL DEFAULT 0, `114` INTEGER NOT NULL DEFAULT 0, `115` INTEGER NOT NULL DEFAULT 0, `116` INTEGER NOT NULL DEFAULT 0, `117` INTEGER NOT NULL DEFAULT 0, `118` INTEGER NOT NULL DEFAULT 0, `119` INTEGER NOT NULL DEFAULT 0, `120` INTEGER NOT NULL DEFAULT 0, `121` INTEGER NOT NULL DEFAULT 0, `122` INTEGER NOT NULL DEFAULT 0, `123` INTEGER NOT NULL DEFAULT 0, `124` INTEGER NOT NULL DEFAULT 0, `125` INTEGER NOT NULL DEFAULT 0, `126` INTEGER NOT NULL DEFAULT 0, `127` INTEGER NOT NULL DEFAULT 0, `128` INTEGER NOT NULL DEFAULT 0, `129` INTEGER NOT NULL DEFAULT 0, `130` INTEGER NOT NULL DEFAULT 0, `131` INTEGER NOT NULL DEFAULT 0, `132` INTEGER NOT NULL DEFAULT 0, `133` INTEGER NOT NULL DEFAULT 0, `134` INTEGER NOT NULL DEFAULT 0, `135` INTEGER NOT NULL DEFAULT 0, `136` INTEGER NOT NULL DEFAULT 0, `137` INTEGER NOT NULL DEFAULT 0, `138` INTEGER NOT NULL DEFAULT 0, `139` INTEGER NOT NULL DEFAULT 0, `140` INTEGER NOT NULL DEFAULT 0, `141` INTEGER NOT NULL DEFAULT 0, `142` INTEGER NOT NULL DEFAULT 0, `143` INTEGER NOT NULL DEFAULT 0, `144` INTEGER NOT NULL DEFAULT 0, `145` INTEGER NOT NULL DEFAULT 0, `146` INTEGER NOT NULL DEFAULT 0, `147` INTEGER NOT NULL DEFAULT 0, `148` INTEGER NOT NULL DEFAULT 0, `149` INTEGER NOT NULL DEFAULT 0, `150` INTEGER NOT NULL DEFAULT 0, `151` INTEGER NOT NULL DEFAULT 0, `152` INTEGER NOT NULL DEFAULT 0, `153` INTEGER NOT NULL DEFAULT 0, `154` INTEGER NOT NULL DEFAULT 0, `155` INTEGER NOT NULL DEFAULT 0, `156` INTEGER NOT NULL DEFAULT 0, `157` INTEGER NOT NULL DEFAULT 0, `158` INTEGER NOT NULL DEFAULT 0, `159` INTEGER NOT NULL DEFAULT 0, `160` INTEGER NOT NULL DEFAULT 0, `161` INTEGER NOT NULL DEFAULT 0, `162` INTEGER NOT NULL DEFAULT 0, `163` INTEGER NOT NULL DEFAULT 0, `164` INTEGER NOT NULL DEFAULT 0, `165` INTEGER NOT NULL DEFAULT 0, `166` INTEGER NOT NULL DEFAULT 0, `167` INTEGER NOT NULL DEFAULT 0, `168` INTEGER NOT NULL DEFAULT 0, `169` INTEGER NOT NULL DEFAULT 0, `170` INTEGER NOT NULL DEFAULT 0, `171` INTEGER NOT NULL DEFAULT 0, `172` INTEGER NOT NULL DEFAULT 0, `173` INTEGER NOT NULL DEFAULT 0, `174` INTEGER NOT NULL DEFAULT 0, `175` INTEGER NOT NULL DEFAULT 0, `176` INTEGER NOT NULL DEFAULT 0, `177` INTEGER NOT NULL DEFAULT 0, `178` INTEGER NOT NULL DEFAULT 0, `179` INTEGER NOT NULL DEFAULT 0, `180` INTEGER NOT NULL DEFAULT 0, `181` INTEGER NOT NULL DEFAULT 0, `182` INTEGER NOT NULL DEFAULT 0, `183` INTEGER NOT NULL DEFAULT 0, `184` INTEGER NOT NULL DEFAULT 0, `185` INTEGER NOT NULL DEFAULT 0, `186` INTEGER NOT NULL DEFAULT 0, `187` INTEGER NOT NULL DEFAULT 0, `188` INTEGER NOT NULL DEFAULT 0, `189` INTEGER NOT NULL DEFAULT 0, `190` INTEGER NOT NULL DEFAULT 0, `191` INTEGER NOT NULL DEFAULT 0, `192` INTEGER NOT NULL DEFAULT 0, `193` INTEGER NOT NULL DEFAULT 0, `194` INTEGER NOT NULL DEFAULT 0, `195` INTEGER NOT NULL DEFAULT 0, `196` INTEGER NOT NULL DEFAULT 0, `197` INTEGER NOT NULL DEFAULT 0, `198` INTEGER NOT NULL DEFAULT 0, `199` INTEGER NOT NULL DEFAULT 0, `200` INTEGER NOT NULL DEFAULT 0, `201` INTEGER NOT NULL DEFAULT 0, `202` INTEGER NOT NULL DEFAULT 0, `203` INTEGER NOT NULL DEFAULT 0, `204` INTEGER NOT NULL DEFAULT 0, `205` INTEGER NOT NULL DEFAULT 0, `206` INTEGER NOT NULL DEFAULT 0, `207` INTEGER NOT NULL DEFAULT 0, `208` INTEGER NOT NULL DEFAULT 0, `209` INTEGER NOT NULL DEFAULT 0, `210` INTEGER NOT NULL DEFAULT 0, `211` INTEGER NOT NULL DEFAULT 0, `212` INTEGER NOT NULL DEFAULT 0, `213` INTEGER NOT NULL DEFAULT 0, `214` INTEGER NOT NULL DEFAULT 0, `215` INTEGER NOT NULL DEFAULT 0, `216` INTEGER NOT NULL DEFAULT 0, `217` INTEGER NOT NULL DEFAULT 0, `218` INTEGER NOT NULL DEFAULT 0, `219` INTEGER NOT NULL DEFAULT 0, `220` INTEGER NOT NULL DEFAULT 0, `221` INTEGER NOT NULL DEFAULT 0, `222` INTEGER NOT NULL DEFAULT 0, `223` INTEGER NOT NULL DEFAULT 0, `224` INTEGER NOT NULL DEFAULT 0, `225` INTEGER NOT NULL DEFAULT 0, `226` INTEGER NOT NULL DEFAULT 0, `227` INTEGER NOT NULL DEFAULT 0, `228` INTEGER NOT NULL DEFAULT 0, `229` INTEGER NOT NULL DEFAULT 0, `230` INTEGER NOT NULL DEFAULT 0, `231` INTEGER NOT NULL DEFAULT 0, `232` INTEGER NOT NULL DEFAULT 0, `233` INTEGER NOT NULL DEFAULT 0, `234` INTEGER NOT NULL DEFAULT 0, `235` INTEGER NOT NULL DEFAULT 0, `236` INTEGER NOT NULL DEFAULT 0, `237` INTEGER NOT NULL DEFAULT 0, `238` INTEGER NOT NULL DEFAULT 0, `239` INTEGER NOT NULL DEFAULT 0, `240` INTEGER NOT NULL DEFAULT 0, `241` INTEGER NOT NULL DEFAULT 0, `242` INTEGER NOT NULL DEFAULT 0, `243` INTEGER NOT NULL DEFAULT 0, `244` INTEGER NOT NULL DEFAULT 0, `245` INTEGER NOT NULL DEFAULT 0, `246` INTEGER NOT NULL DEFAULT 0, `247` INTEGER NOT NULL DEFAULT 0, `248` INTEGER NOT NULL DEFAULT 0, `249` INTEGER NOT NULL DEFAULT 0, `250` INTEGER NOT NULL DEFAULT 0, `251` INTEGER NOT NULL DEFAULT 0, `252` INTEGER NOT NULL DEFAULT 0, `253` INTEGER NOT NULL DEFAULT 0, `254` INTEGER NOT NULL DEFAULT 0, '101' INTEGER NOT NULL DEFAULT 0, 'suspended' BOOLEAN NOT NULL DEFAULT 0, 'referred_by' INTEGER DEFAULT NULL);
CREATE TABLE 'board_placements' ('board' INTEGER NOT NULL, 'x' INTEGER NOT NULL, 'y' INTEGER NOT NULL, 'gem' INTEGER NOT NULL, 'user' INTEGER NOT NULL, 'placed_at'  INTEGER NOT NULL  );
CREATE TABLE 'alloy_casts' ('id' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 'owner' INTEGER NOT NULL, 'gem' INTEGER NOT NULL, 'amount' INTEGER NOT NULL, 'time_started'  INTEGER NOT NULL  );
CREATE TABLE 'modifiers' ('id' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 'owner' INTEGER, 'type' INTEGER);
CREATE TABLE 'pickaxe_parts' ('id' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 'owner' INTEGER NOT NULL, 'material' INTEGER NOT NULL, 'type'  TEXT NOT NULL  );
CREATE TABLE 'pickaxes' ('id' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 'handle' INTEGER NOT NULL, 'head' INTEGER NOT NULL, 'binding' INTEGER NOT NULL, 'modifiers' INTEGER NOT NULL, 'uses' INTEGER NOT NULL DEFAULT 0 , 'owner' INTEGER NOT NULL, 'date_created' INTEGER NOT NULL, 'name' TEXT NOT NULL DEFAULT 'pickaxe', 'starred' BOOLEAN NOT NULL DEFAULT 0);
CREATE TABLE 'crates' ('id' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 'rarity' INTEGER NOT NULL, 'owner' INTEGER NOT NULL);
CREATE TABLE 'codes' ('id' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 'code_hash' TEXT NOT NULL, 'data' TEXT NOT NULL);
CREATE TABLE 'owned_codes' ('owner' INTEGER NOT NULL, 'code_id' INTEGER NOT NULL, 'code' TEXT NOT NULL);
CREATE VIEW 'collections_by_score' AS SELECT *, coalesce((SELECT sum(r.is_positive = 1) - sum(r.is_positive = 0) FROM collection_ratings r WHERE r.collection = c.id ), 0) as score FROM collections c ORDER BY score DESC;
CREATE TRIGGER 'rate_own_collection' AFTER INSERT ON "collections" FOR EACH ROW BEGIN INSERT INTO collection_ratings (rater, collection, is_positive) VALUES (NEW.by, NEW.id, 1); END;
CREATE TRIGGER 'remove_existing_rating' BEFORE INSERT ON "collection_ratings" FOR EACH ROW BEGIN DELETE FROM collection_ratings WHERE collection = NEW.collection AND rater = NEW.rater; END;
CREATE TRIGGER 'message_unread' AFTER INSERT ON "messages" FOR EACH ROW BEGIN UPDATE users SET read_notifications = 0 WHERE id = NEW.recipient; END;
CREATE TRIGGER 'announcement_unread' AFTER INSERT ON "announcements" BEGIN UPDATE users SET read_announcements = 0; END;
CREATE TRIGGER 'create_pfp' AFTER INSERT ON "users" FOR EACH ROW BEGIN INSERT INTO collections (is_pfp, name, type, by, created_at, data) VALUES (1, NEW.name||"'s profile picture", 3, NEW.id, strftime('%s','now'), '[[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]]'); END;
COMMIT;